<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hong Chuan</title>
  
  
  <link href="http://redtecher.cn/atom.xml" rel="self"/>
  
  <link href="http://redtecher.cn/"/>
  <updated>2024-11-23T03:41:53.081Z</updated>
  <id>http://redtecher.cn/</id>
  
  <author>
    <name>Hong Chuan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>MISC流量分析题</title>
    <link href="http://redtecher.cn/2024/11/23/post/"/>
    <id>http://redtecher.cn/2024/11/23/post/</id>
    <published>2024-11-23T03:04:19.000Z</published>
    <updated>2024-11-23T03:41:53.081Z</updated>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer" /># <font style="color:rgb(29, 33, 41);">1.流量分析1</font>拉入科来流量分析<p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732171335315-084b0fb5-dc39-4cd5-b153-e07d55e510a1.png"></p><p>很明显应该在http request和response里面</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732171292337-c931dcf7-bc5f-452d-a8b0-364c8b185125.png"></p><p>明显发现有select from flag 字样 而且有%25</p><p>所以应该是进行了两层url编码</p><p>解析一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line">encoded_str  = <span class="string">&#x27;/index.php?url=gopher://127.0.0.1:80/_POST%20%2Fadmin.php%20HTTP%2F1.1%250d%250aHost%3A%20localhost%3A80%250d%250aConnection%3A%20close%250d%250aContent-Type%3A%20application%2Fx-www-form-urlencoded%250d%250aContent-Length%3A%2078%250d%250a%250d%250aid%253D1%2529%2520and%2520if%2528%2528ascii%2528substr%2528%2528select%2520flag%2520from%2520flag%2529%252C1%252C1%2529%2529%253D%252740%2527%2529%252Csleep%25283%2529%252C0%2529%2520--%2520&#x27;</span></span><br><span class="line"><span class="comment"># s1 =&quot;%29%2C1%2C1%29%29%3D%2740%27%29%2C&quot;</span></span><br><span class="line"><span class="comment"># wd = parse.quote(keyword.encode(&#x27;utf-8&#x27;))</span></span><br><span class="line"><span class="comment"># ress = parse.quote(wd.encode(&#x27;gb2312&#x27;))</span></span><br><span class="line">decode_str = parse.unquote(encoded_str)</span><br><span class="line">dedecode_str = parse.unquote(decode_str)</span><br><span class="line"><span class="built_in">print</span>(dedecode_str)</span><br></pre></td></tr></table></figure><p>输出为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/index.php?url=gopher://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">80</span>/_POST /admin.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: localhost:<span class="number">80</span></span><br><span class="line">Connection: close</span><br><span class="line">Content-<span class="type">Type</span>: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: <span class="number">78</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">id</span>=<span class="number">1</span>) <span class="keyword">and</span> <span class="keyword">if</span>((<span class="built_in">ascii</span>(substr((select flag <span class="keyword">from</span> flag),<span class="number">1</span>,<span class="number">1</span>))=<span class="string">&#x27;40&#x27;</span>),sleep(<span class="number">3</span>),<span class="number">0</span>) </span><br></pre></td></tr></table></figure><p>分析这行sql语句意思，如果选择字符ascii等于40,那么延迟3秒</p><p>应该是进行sql盲注</p><h1 id="2-流量分析2"><a href="#2-流量分析2" class="headerlink" title="2.流量分析2"></a>2.流量分析2</h1><p>拉入科来</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732239116277-b8c3f32f-02ed-4ce0-a06e-da1975b0232a.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732239148138-26028d06-b859-4fda-a1d4-176bd40d0e61.png"></p><p>用get方法获取html页面</p><p>过滤一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">srcip=<span class="number">39.105</span><span class="number">.136</span><span class="number">.196</span> <span class="keyword">and</span> protocol=http</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732239062844-1f7047b3-a6db-4a89-9955-61dd0e7aaeaa.png"></p><p>生成flag为 flag{17uajil}</p><h1 id="3-easycap"><a href="#3-easycap" class="headerlink" title="3.easycap"></a>3.easycap</h1><p>拉入科来</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732239486589-ac7058b2-4baf-4ca5-a5a1-9272f545d445.png"></p><p>点开看 每个额外数据都有</p><p>字符</p><p>写代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyshark</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">cap = pyshark.FileCapture(<span class="string">&quot;d5ba8f87969145059170a222f01e7883.pcap&quot;</span>, tshark_path=<span class="string">&quot;D:\Program Files\Wireshark\\tshark.exe&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(cap)</span><br><span class="line"><span class="keyword">for</span> pkt <span class="keyword">in</span> cap:</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">int</span>(pkt.length)==<span class="number">67</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(pkt.tcp.payload).decode(<span class="string">&#x27;utf-8&#x27;</span>),end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>简单解码解析，组装输出payload值 </p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732241357548-2a5cbbc3-ec40-4121-94a0-e23836dd8ab7.png"></p><h1 id="4-流量分析"><a href="#4-流量分析" class="headerlink" title="4.流量分析"></a>4.流量分析</h1><p>拉入进行流量分析，筛选http协议</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732246195514-a0ba8d5b-e21e-4fca-9ad0-3d0a72b71fc5.png"></p><p>显然是盲注攻击</p><p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732246217952-39b99e5b-7fd8-409a-8cd9-0998fd7c9bf0.png"></p><p>筛选数据包，如果sql注入攻击失败，返回http_response 数据包大小为661</p><p>注入成功返回数据包大于661 </p><p>所以进行筛选</p><p>写代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyshark</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">cap = pyshark.FileCapture(<span class="string">&quot;4d7c14206a5c4b74a0af595992bbf439.pcapng&quot;</span>, display_filter=<span class="string">&#x27;http&#x27;</span>, tshark_path=<span class="string">&quot;D:\Program Files\Wireshark\\tshark.exe&quot;</span>)</span><br><span class="line"><span class="comment"># print(cap)</span></span><br><span class="line">flagit = [<span class="string">&#x27;.&#x27;</span>*<span class="number">40</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>)]</span><br><span class="line">p1 = <span class="string">r&#x27;flag%20limit%200,1\),(\d+),1\)&#x27;</span></span><br><span class="line">p2 = <span class="string">r&#x27;,1\)\)=(\d+)%23&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> pkt <span class="keyword">in</span> cap:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(pkt.length) &lt; <span class="number">600</span>: <span class="comment"># 当包长度小于 650 时为请求包，记录uri 和 时间</span></span><br><span class="line">        time_s = pkt.sniff_time</span><br><span class="line">        url = pkt.http.request_full_uri</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">int</span>(pkt.length) &gt; <span class="number">661</span>):</span><br><span class="line">            k = re.findall(p1,<span class="built_in">str</span>(url))</span><br><span class="line">            d = re.findall(p2,<span class="built_in">str</span>(url))</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">int</span>(k[<span class="number">0</span>]))</span><br><span class="line">            flagit[<span class="built_in">int</span>(k[<span class="number">0</span>])-<span class="number">1</span>]=<span class="built_in">chr</span>(<span class="built_in">int</span>(d[<span class="number">0</span>]))</span><br><span class="line">flag =<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag.join(flagit))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2024/png/47776519/1732246244172-ecd4ae63-8f39-4ea4-9feb-8b780ec5fa1b.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;c2bbf9cecdaf656cf524d014c5bf046c&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot; /&gt;
# &lt;font style=&quot;color:rgb(29, 33, 41);&quot;&gt;1.流量分析1&lt;/font&gt;
拉入科来流量分析

&lt;p&gt;&lt;img src=&quot;https://cdn.nlar</summary>
      
    
    
    
    <category term="CTF" scheme="http://redtecher.cn/categories/CTF/"/>
    
    
    <category term="流量分析，MISC" scheme="http://redtecher.cn/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90%EF%BC%8CMISC/"/>
    
  </entry>
  
</feed>
